#/bin/bash

# [install cookbook](https://wiki.gentoo.org/wiki/Handbook:AMD64)


parted -s -a optimal /dev/sda mklabel gpt -- mkpart primary 1 3 name 1 grub set 1 bios_grub on
parted -s -a optimal /dev/sda mklabel gpt -- mkpart primary ext2 3 131 name 2 boot set 2 boot on
parted -s -a optimal /dev/sda mklabel gpt -- mkpart primary linux-swap 131 643 name 3 swap 
parted -s -a optimal /dev/sda mklabel gpt -- mkpart primary ext4 643 -1 name 4 rootfs

swapon /dev/sda3

# install stage3 

cd /mnt/gentoo
wget https://ftp.jaist.ac.jp/pub/Linux/Gentoo/releases/amd64/autobuilds/current-stage3-amd64-systemd/stage3-amd64-systemd-20210407T214504Z.tar.xz

tar xpvf stage3-*.tar.xz --xattrs-include='*.*' --numeric-owner

rm *.tar.xz

# add mirror

# create ebuild repository
mkdir --parents /mnt/gentoo/etc/portage/repos.conf

cp /mnt/gentoo/usr/share/portage/config/repos.conf /mnt/gentoo/etc/portage/repos.conf/gentoo.conf

